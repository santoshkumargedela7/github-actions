import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.vault.core.VaultOperations;
import org.springframework.vault.core.VaultTemplate;
import org.springframework.vault.authentication.AppRoleAuthentication;
import org.springframework.vault.authentication.AppRoleAuthenticationOptions;
import org.springframework.vault.config.EnvironmentVaultConfiguration;

@Configuration
public class VaultConfig {

    @Bean
    public VaultOperations vaultOperations() {
        EnvironmentVaultConfiguration vaultConfiguration = new EnvironmentVaultConfiguration();
        VaultTemplate vaultTemplate = new VaultTemplate(vaultConfiguration.restOperations(),
                                                        vaultConfiguration.sessionManager(),
                                                        vaultConfiguration.reactiveSessionManager());
        AppRoleAuthenticationOptions options = AppRoleAuthenticationOptions.builder()
                .role(AppRoleAuthenticationOptions.RoleId.provided("your-role-id"))
                .secret(AppRoleAuthenticationOptions.SecretId.provided("your-secret-id"))
                .build();
        AppRoleAuthentication auth = new AppRoleAuthentication(options, vaultTemplate.getRestOperations());
        vaultTemplate.setAuthentication(auth);
        return vaultTemplate;
    }
}
